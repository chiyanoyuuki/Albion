<div>

    <img draggable="false" class="retour" [hidden]="data.lieuActuel.parent==''"
        src="./assets/images/retour.png" (click)="clickRetour()" (mouseover)="focus=undefined" />
    <img draggable="false" class="map" src="./assets/images/{{data.lieuActuel.image}}.png" (click)="clicMap()"
        (contextmenu)="clicDroitMap($event)" />

    <!-- ========================== LIEUX ========================== -->

    <div *ngFor="let lieu of getLieux()" class="lieux" [style.left]="lieu.x+'px'" [style.top]="lieu.y+'px'"
        [style.width]="lieu.finx+'px'" [style.height]="lieu.finy+'px'" (click)="rentrerLieu(lieu)">

        <!--(cdkDragEnded)="dragEnd($event,lieu)" 
        cdkDrag>-->

        <p class="nomLieu" (mouseover)="focus=undefined">{{lieu.nom}}</p>

        <div class="personnagesInside">
            <div>
                <app-icone-personnage *ngFor="let perso of getPersonnagesDansLieu(lieu)" [perso]="perso"
                    (mouseover)="focus=perso" (click)="sortirPerso(lieu,perso)"></app-icone-personnage>
            </div>
        </div>

        <!-- ========================== FENETRE DE CHANGEMENT DE LIEU ========================== -->

        <div class="changeLieu fenetre" *ngIf="changingTo==lieu">
            <p class="bigText">Qui rentre dans {{changingTo.nom}} ?</p>
            <div class="line"></div>
            <div class="flexCenter">
                <div>
                    <app-icone-personnage *ngFor="let perso of getEntitesPresentes(0)" [perso]="perso"
                        (mouseover)="focus=perso" (click)="rentrerEntite(lieu,perso)"
                        (mouseover)="persoHovered[0]=perso.nom + ' - ' + perso.pdv + '/'+perso.pdvmax"
                        (mouseout)="persoHovered[0]=''"></app-icone-personnage>
                </div>
            </div>
            <p class="nomPerso">{{persoHovered[0]}}</p>
            <div class="flexCenter">
                <div>
                    <app-icone-personnage *ngFor="let perso of getEntitesPresentes(1)" [perso]="perso"
                        (mouseover)="focus=perso" (click)="rentrerEntite(lieu,perso)"
                        (mouseover)="persoHovered[1]=perso.nom + ' - ' + perso.pdv + '/'+perso.pdvmax"
                        (mouseout)="persoHovered[1]=''"></app-icone-personnage>
                </div>
            </div>
            <p class="nomPerso">{{persoHovered[1]}}</p>
            <div class="flexCenter">
                <div>
                    <app-icone-personnage *ngFor="let perso of getEntitesPresentes(2)" [perso]="perso"
                        (mouseover)="focus=perso" (click)="rentrerEntite(lieu,perso)"
                        (mouseover)="persoHovered[2]=perso.nom + ' - ' + perso.pdv + '/'+perso.pdvmax"
                        (mouseout)="persoHovered[2]=''"></app-icone-personnage>
                </div>
            </div>
            <p class="nomPerso">{{persoHovered[2]}}</p>
            <div class="line"></div>
            <p class="choix" (click)="changeLieu(lieu)">Entrer</p>
        </div>
    </div>

    <!-- ========================== PERSONNAGES ========================== -->

    <app-entites [data]="data" class="entites"></app-entites>

    <!-- ========================== MENU CONTEXTUEL ========================== -->

    <app-menu-contextuel class="menuContextuel" *ngIf="menuContextuel!=undefined" [menu]="menuContextuel" [data]="data" (addEntityEvent)="addEntity($event)">
    </app-menu-contextuel>

</div>