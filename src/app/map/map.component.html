<div>
    <video class="video" *ngIf="cataclysme" id="my_video_1" class="video-js vjs-default-skin" controls preload="none"
        style="position: absolute;z-index: 10;background-color: black;width: 1902px;height: fit-content;"
        data-setup='{ "aspectRatio":"640:267", "playbackRates": [1, 1.5, 2] }'>
        <source src="../../assets/images/CinÃ©matique.mp4" type='video/mp4' />
    </video>
    <img draggable="false" class="retour" [hidden]="data.lieuActuel.parent==''" src="./assets/images/retour.png"
        (click)="clickRetour()" (mouseover)="focus=undefined" />
    <img draggable="false" class="map" [style.width]="windowWidth-60+'px'"
        src="./assets/images/maps/{{data.lieuActuel.image}}{{(data.lieuActuel.useNbImage?data.lieuActuel.nbImage:'')}}.png"
        (click)="clicMap($event)" (contextmenu)="clicDroitMap($event)" id="map"
        [style.border]="data.admin?'20px ridge #dd2020':'20px ridge #202020'" />

    <!-- ========================== LIEUX ========================== -->

    <div *ngFor="let lieu of getLieux()" class="lieux" [style.left]="lieu.x+'px'" [style.top]="lieu.y+'px'"
        [style.width]="lieu.finx+'px'" [style.height]="lieu.finy+'px'" (click)="rentrerLieu(lieu)"
        [cdkDragDisabled]="!data.admin" (cdkDragEnded)="endDragLieu($event,lieu)" cdkDrag>

        <!--(cdkDragEnded)="dragEnd($event,lieu)" 
        cdkDrag>-->

        <p class="nomLieu" (mouseover)="focus=undefined">{{lieu.nom}}</p>

        <div class="personnagesInside">
            <div *ngFor="let perso of getJoueursDansLieu(lieu)">
                <app-icone-personnage [perso]="perso" (mouseover)="focus=perso" (click)="sortirPerso(lieu,perso)">
                </app-icone-personnage>
            </div>
        </div>

        <!-- ========================== FENETRE DE CHANGEMENT DE LIEU ========================== -->

        <div class="changeLieu fenetre" *ngIf="changingTo==lieu&&(lieu.canEnter==undefined||lieu.canEnter)">
            <p class="bigText">Qui rentre dans {{changingTo.nom}} ?</p>
            <div class="line"></div>
            <div class="flexCenter">
                <div>
                    <app-icone-personnage *ngFor="let perso of getEntitesPresentes(0)" [perso]="perso"
                        (mouseover)="focus=perso" (click)="rentrerEntite(lieu,perso)"
                        (mouseover)="persoHovered[0]=perso.nom + ' - ' + perso.pdv + '/'+perso.pdvmax"
                        (mouseout)="persoHovered[0]=''"></app-icone-personnage>
                </div>
            </div>
            <p class="nomPerso">{{persoHovered[0]}}</p>
            <div class="flexCenter">
                <div>
                    <app-icone-personnage *ngFor="let perso of getEntitesPresentes(1)" [perso]="perso"
                        (mouseover)="focus=perso" (click)="rentrerEntite(lieu,perso)"
                        (mouseover)="persoHovered[1]=perso.nom + ' - ' + perso.pdv + '/'+perso.pdvmax"
                        (mouseout)="persoHovered[1]=''"></app-icone-personnage>
                </div>
            </div>
            <p class="nomPerso">{{persoHovered[1]}}</p>
            <div class="flexCenter">
                <div>
                    <app-icone-personnage *ngFor="let perso of getEntitesPresentes(2)" [perso]="perso"
                        (mouseover)="focus=perso" (click)="rentrerEntite(lieu,perso)"
                        (mouseover)="persoHovered[2]=perso.nom + ' - ' + perso.pdv + '/'+perso.pdvmax"
                        (mouseout)="persoHovered[2]=''"></app-icone-personnage>
                </div>
            </div>
            <p class="nomPerso">{{persoHovered[2]}}</p>
            <div class="line"></div>
            <p class="choix" (click)="changeLieu(lieu)">Entrer</p>
        </div>
    </div>

    <!-- ========================== PERSONNAGES ========================== -->

    <app-entites [data]="data" [mapHeight]="mapHeight" class="entites"></app-entites>

    <!-- ========================== MENU CONTEXTUEL ========================== -->

    <app-menu-contextuel class="menuContextuel" *ngIf="menuContextuel!=undefined" [menu]="menuContextuel" [data]="data"
        (closeEvent)="menuContextuel=undefined" (addEntityEvent)="addEntity($event)">
    </app-menu-contextuel>

</div>