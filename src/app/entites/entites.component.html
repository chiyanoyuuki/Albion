<div>
    <div [ngClass]="{'container':true,'dead':perso.pdv<=0}" *ngFor="let perso of getEntitesPresentes()"
        [style.left]="(data.lieuActuel.parent==''?perso.x:perso.xcombat)+'px'"
        [style.top]="(data.lieuActuel.parent==''?perso.y:perso.ycombat)+'px'"
        [style.z-index]="perso==lastPersoClicked?2:1" (cdkDragEnded)="dragEnd($event,perso)"
        (cdkDragStarted)="lastPersoClicked=perso" (contextmenu)="clicDroit($event, perso)"
        (click)="lastPersoClicked=perso" cdkDrag>

        <!-- PARTIE INFOS =================================================== -->

        <div class="entite">
            <app-infos-entite [perso]="perso" (persoActuel)="clickPersoActuel($event)"></app-infos-entite>
        </div>

        <!-- IMAGE + SHADOW =================================================== -->

        <div class="containerPerso"
            [style.top]="(this.data.lieuActuel.scale&&this.data.lieuActuel.scale>1?(this.data.lieuActuel.scale)*20+79+'px':'84px')"
            [style.transform]="'scale(' + (this.data.lieuActuel.scale?this.data.lieuActuel.scale:1) + ')'"
            [style.left]="(perso.overrideX?perso.overrideX+'%':'40%')">
            <div class="perso" [ngClass]="{'revert':isReverted(perso)}">
                <img class="imageperso" draggable="false" src="./assets/images/{{perso.image}}.png" cdkDragHandle />
                <div class="flexCenter">
                    <div class="shadow " cdkDragHandle></div>
                </div>
            </div>
        </div>

        <!-- LEVEL =================================================== -->

        <app-level [niveau]="perso.niveau"></app-level>

        <!-- ========================== MENU CONTEXTUEL ========================== -->

        <app-menu-contextuel class="menuContextuel"
            *ngIf="menuContextuel&&persoMenuContextuel&&persoMenuContextuel==perso" [menu]="menuContextuel"
            [data]="data" (deleteEvent)="majFromChild()">
        </app-menu-contextuel>

        <!-- STATS PERSO ACTIF ================================================= -->

        <app-stats-personnage [perso]="perso" [data]="data"
            *ngIf="(persoActuel == 'equipe' || persoActuel == 'neutre' || persoActuel == 'ennemi') && nomPersoActuel == perso.nom">
        </app-stats-personnage>
    </div>
</div>