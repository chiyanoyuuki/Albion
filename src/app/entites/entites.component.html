<div [ngClass]="type">
    <div [ngClass]="{'container':true,'dead':perso.pdv<=0}" *ngFor="let perso of getEntites()"
        [style.left]="(data.lieuActuel.parent==''?perso.x:perso.xcombat)+'px'"
        [style.top]="(data.lieuActuel.parent==''?perso.y:perso.ycombat)+'px'" (cdkDragEnded)="dragEnd($event,perso)"
        cdkDrag>

        <div class="entite" (click)="perso.actif=!perso.actif">
            <p class="text nom">{{perso.nom}}</p>
            <p class="text etat">{{perso.etat}}</p>

            <div class="flex bottomGroup">
                <div class="pdvmana">
                    <div class="flex pdvmanadiv">
                        <p class="pdvtext">{{perso.pdv}}/{{perso.pdvmax}}</p>
                        <div class="grouppdvmana">
                            <img class="fill" draggable="false" src="./assets/images/pdvfill.PNG"
                                [style.width]="(perso.pdv/perso.pdvmax)*100+'%'" />
                            <img draggable="false" src="./assets/images/pdvmanabar.png" />
                        </div>
                    </div>
                    <div class="flex pdvmanadiv">
                        <p class="manatext">{{perso.mana}}/{{perso.manamax}}</p>
                        <div class="grouppdvmana">
                            <img class="fill" draggable="false" src="./assets/images/manafill.PNG" />
                            <img draggable="false" src="./assets/images/pdvmanabar.png" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IMAGE + SHADOW =================================================== -->

        <div class="containerPerso"
            [style.transform]="'scale(' + (this.data.lieuActuel.scale?this.data.lieuActuel.scale:1) + ')'">
            <div class="perso" [ngClass]="{'revert':isReverted(perso)}"
                [style.top]="(this.data.lieuActuel.scale?(this.data.lieuActuel.scale)*8+'px':'5px')">
                <img class="imageperso" draggable="false" src="./assets/images/{{perso.image}}.png" cdkDragHandle />
                <div class="shadow " cdkDragHandle></div>
            </div>
        </div>

        <!-- STATS PERSO ACTIF ================================================= -->

        <div *ngIf="perso.actif" class="container-stats">
            <div class="block-perso">
                <h2>{{ perso.nom }}</h2>
                <h3>{{ perso.classe | titlecase }}</h3>
                <h3>{{ perso.etat }}</h3>
            </div>
            <div class="block-forme">
                <div>
                    <p><span class="title">Forme actuelle : </span>{{ perso.forme }}</p>
                    <ul>
                        <p class="title">Transformation possible:</p>
                        <li *ngFor="let forme of perso.formes">
                            <p *ngIf="forme != perso.forme" (click)="perso.forme = forme">{{ forme }}</p>
                        </li>
                    </ul>
                </div>
                <div>
                    <p>
                        <button (click)="perso.argent = perso.argent - 1">-</button>
                        Or: {{ perso.argent }}
                        <button (click)="perso.argent = perso.argent + 1">+</button>
                    </p>
                </div>
            </div>

            <div class="block-armes flex width-100 between">
                <p *ngIf="perso.arme1"><span class="title">Main principale : </span>{{ perso.arme1 }}</p>
                <p *ngIf="perso.arme2"><span class="title">Main secondaire : </span>{{ perso.arme2 }}</p>
            </div>
            <div class="block-stats">
                <h3 class="title">Stats Perso :</h3>
                <ul>
                    <li *ngFor="let stat of perso.stats">
                        <p>
                            <button (click)="stat.qte = stat.qte - 1">-</button>
                            {{ stat.nom }} : {{ stat.qte }}
                            <button (click)="stat.qte = stat.qte + 1">+</button>
                        </p>
                    </li>
                </ul>
            </div>
            <div class="block-stuff">
                <h3 class="title">Stuffs Perso :</h3>
                <ul>
                    <li *ngFor="let stuff of perso.inventaire">
                        <p *ngIf="stuff.qte">
                            <button (click)="stuff.qte = stuff.qte - 1">-</button>
                            {{ stuff.nom }} : {{ stuff.qte }}
                            <button (click)="stuff.qte = stuff.qte + 1">+</button>
                        </p>
                    </li>
                </ul>

            </div>
        </div>
    </div>
</div>